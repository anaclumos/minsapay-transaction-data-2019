# 2019년 민사페이 익명 거래 데이터

[![](https://img.shields.io/badge/license-mit-orange?longCache=true&style=for-the-badge)](LICENSE.md) [![](https://img.shields.io/badge/read_in-English-blue?longCache=true&style=for-the-badge)](README.md)

민사페이는 민족사관고등학교 여름 축제(민족제)를 위해서 제작된 전자 거래 플랫폼입니다. 민사페이 팀은 학생들이 실생활에 밀접한 곳에서 데이터 분석을 공부할 수 있도록 돕는 동시에 내년 민족제 운영진들이 축제 운영에 참고할 수 있도록 모든 거래 데이터를 공개하기로 결정했습니다. 금융 데이터는 개인이 특정될 경우 악용될 여지가 있으므로 모든 축제 부스와 사용자를 익명 처리하였으며, 그 외에는 어떠한 전처리도 일어나지 않은 원본 거래 데이터입니다.

## 통계

|항목|데이터|
|----|----|
|사용자|400명|
|거래 횟수|2,900건|
|누적 지불액|460만 4,210원|
|누적 거래액|1,731만 9,300원|

`누적 지불액`은 부스에서 판매되는 상품이나 서비스를 위해 돈을 지불한 금액의 총합입니다. `누적 거래액`은 민사페이를 통해 거래된 모든 보조금, 예금액, 지불액, 출금액의 총합입니다.

## 지표 및 설명
|지표|설명|
|----|----|
|transaction|거래 번호를 나타냅니다.|
|user|사용자 번호를 나타냅니다.|
|booth|부스 번호를 나타냅니다.|
|timestamp|거래가 일어난 시간을 나타냅니다.|
|type|거래의 종류를 나타냅니다.|
|amount|거래금의 양을 나타냅니다.|
|balance|거래가 일어난 뒤 사용자의 잔액을 나타냅니다.|

거래의 종류에는 4가지가 있습니다.

|종류|설명|
|----|----|
|open|계좌를 개설하는 행위입니다. 3학년 학생의 경우 7,000원의 보조금을 제공하며, 선생님의 경우 10,000원의 보조금을 제공합니다. 참고 사항을 확인하세요.|
|charge|계좌를 충전하는 행위입니다. 현금은 학생회(금융정보부) 부원에게 직접 전달하며, 해당 부원이 금액을 충전해줍니다.|
|pay|돈을 지불하는 행위입니다. 거래 내역은 학생과 부스 모두에게 기록됩니다.|
|withdraw|계좌의 잔액을 인출하는 행위입니다. 학생회(금융정보부) 부원이 직접 인출해주어야 하며, 해당 부원이 금액을 직접 전달해줍니다.|

부스는 차후에 거래 내역에 기반해 매출을 따로 정산할 수 있습니다. 원금을 제외한 모든 이익은 학생 자치 활동에 사용됩니다.

## 참고 사항

* 계좌 개설 및 충전이 일어난 부스는 학생회(금융정보부) 부스이며, `booth#000`입니다.
* 축제 운영진들 사이에서 선생님들께 무상으로 음식을 제공하기로 합의되었습니다. 때문에 선생님들에게는 100만원 또는 그 이상의 금액이 충전되었습니다.
* 3명의 학생들이 충전 오류가 있었습니다.
    * `user#298` 사용자는 `561`번 거래에서 546만 4526원이 잘못 충전되었습니다. 이는 학생회 부원이 여러 데이터를 입력하다 데이터를 잘못 제출한 것으로, 12초 후인 `565`번 거래에서 같은 학생회 부원이 금액을 바로잡았습니다. 
    * `user#295` 사용자는 `557`번 거래에서 21억 4748만 3647원이 잘못 충전되었습니다. 이는 학생회 부원의 실수로 **충전 금액 칸**에 학생증의 RFID가 태그되어 일어난 일입니다. RFID 값이 `int` 변수의 최대치를 넘었기에 충전 금액이 `int` 변수의 최대 표현 수치인 2,147,483,647으로 처리된 결과입니다. 학생회에서 이 문제를 나중에 인지하였고, `2624`번 거래에서 사용한 돈을 직접 정산하여 처리하였습니다.
    * `user#284` 사용자는 `2844`번 거래에서 21억 4748만 3647원이 잘못 충전되었습니다. `user#295` 사용자와 동일한 이유로 오류가 발생했으며, 11초 후 `2845`번 거래에서 이를 바로잡았습니다.
* 축제 당일 오전 10시 17분 55초부터 오전 10시 31분 10초까지 `13분 15초` 동안 민사페이 서버 장애가 발생되었습니다. 이는 `1546`번 거래와 `1547`번 거래 사이에서 확인이 가능합니다. 데이터베이스 무료 플랜을 사용하던 와중 일시적으로 거래가 몰려 서버 장애가 발생하게 되었으며, 이후 데이터베이스 유료 플랜을 결제하자 문제가 재발하지 않았습니다.
* 서버 장애가 일어난 동안 각 부스 운영진들은 독자적으로 엑셀 시트로 외상 장부를 만들어 별도로 거래 내용을 기록했습니다. 축제가 모두 끝난 이후 이 장부들을 수집하여 **외상 부스**를 통해 모두 값을 지불했습니다. 외상 부스는 `booth#017`입니다.
* `booth#001`에서 반복적으로 0원으로 결제가 이루어졌습니다. 이는 `booth#001`에서 발급한 무료 이용권 때문입니다. 무료 이용권은 `booth#001`에서 지정한 사람들에게 배부되었으며, `booth#001`의 모든 상품 및 서비스를 무료로 제한 없이 구매할 수 있었습니다.

## `anonymize.ipynb`

```python
import pandas as pd
Dataframe = pd.read_csv('raw.csv')
def anonymize(df, targetColumn):
    anon = {}
    id = 0
    for x in range(len(df)):
        user = df.loc[x, targetColumn]
        if user in anon:
            df.loc[x, targetColumn] = anon[user]
        else:
            if id < 10:
                unknown = "#00"+ str(id)
            elif id < 100:
                unknown = "#0" + str(id)
            else:
                unknown = "#"    + str(id)
            anon[user] = targetColumn + str(unknown)
            id += 1
            df.loc[x, targetColumn] = anon[user]
anonymize(Dataframe, 'user')
anonymize(Dataframe, 'booth')
Dataframe.to_csv("anonymized.csv", mode='w')
```
* 각 사용자와 부스에게 등장하는 순서대로 번호를 부여됩니다.
* 동일한 값은 동일한 번호로 익명화됩니다.
* [익명화된 데이터](transactions.csv)입니다.
